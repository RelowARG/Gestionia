services:
  backend-server:
    build: .
    container_name: gestionia-backend-server
    restart: always
    ports:
      - "3001:3001"
    env_file:
      - .env
    volumes:
      - .:/app
      - /app/node_modules
    command: node server.js

  detector-fuga:
    build: .
    container_name: gestionia-detector-fuga
    restart: always
    env_file:
      - .env
    volumes:
      - .:/app
      - /app/node_modules
    command: node detector_fuga.js

  campana-mails:
    build: .
    container_name: gestionia-campana-mails
    restart: always
    env_file:
      - .env
    volumes:
      - .:/app
      - /app/node_modules
    command: node campana_mails.js

  # AHORA S√ç: El Minero de Mails original
  minero-mails:
    build: .
    container_name: gestionia-minero-mails
    restart: always
    env_file:
      - .env
    volumes:
      - .:/app
      - /app/node_modules
    command: node minero_mails.js

  # EL NUEVO: El Minero de PDFs
  minero-pdfs:
    build: .
    container_name: gestionia-minero-pdfs
    restart: always
    env_file:
      - .env
    volumes:
      - .:/app
      - /app/node_modules
    command: node importar_pdfs.js

  recepcionista-mails:
    build: .
    container_name: gestionia-recepcionista-mails
    restart: always
    env_file:
      - .env
    volumes:
      - .:/app
      - /app/node_modules
    command: node recepcionista_mails.js

  yuki-server:
    build: 
      context: E:/yuki-studio 
      dockerfile: Dockerfile
    container_name: yuki-server
    restart: always
    ports:
      - "4000:4000" 
    volumes:
      - E:/yuki-studio:/app
      - E:/Gestionia:/gestionia
      - /app/node_modules
    command: node yuki_server.js

    # üóÑÔ∏è LA BASE DE DATOS DOCKERIZADA
  mysql-db:
    image: mysql:8.0
    container_name: gestionia-mysql
    restart: always
    command: --lower_case_table_names=1
    environment:
      MYSQL_ROOT_PASSWORD: Milo200723!
      MYSQL_DATABASE: software_gestion_db
    ports:
      - "3306:3306"
    volumes:
      - db_data:/var/lib/mysql
      - ./init-db:/docker-entrypoint-initdb.d

  # üõ°Ô∏è EL SISTEMA DE AUTOBACKUPS
  auto-backup:
    image: fradelg/mysql-cron-backup
    container_name: gestionia-autobackup
    restart: always
    depends_on:
      - mysql-db
    environment:
      MYSQL_HOST: mysql-db
      MYSQL_USER: root
      MYSQL_PASS: Milo200723!
      CRON_TIME: "0 3 * * *"
      MAX_BACKUPS: 7
      INIT_BACKUP: "1"
    volumes:
      - ./backups:/backup
volumes:
  db_data: